# **쿠키와 세션**

**왜? 공부했는가?**

---

[https://www.youtube.com/watch?v=tosLBcAX1vk](https://www.youtube.com/watch?v=tosLBcAX1vk)

youtube 영상으로 쿠키, 세션, 토큰 관련 영상을 보다가 계속 헷갈려서 정리가 필요했다.

영상과 기술 블로그를 참고하면서 다시 나의 말로 정리해보고자 했다.

HTTP프로토콜의 특징에 대해서 알고 넘어가야 한다.

얘는 두 가지 특징이 있다. 바로 비연결 지향, 상태정보를 유지하지 않으려는 특징 이렇게 두가지이다.

비연결 지향

---

- 클라이언트가 request를 서버에 보내고, 서버가 요청에 대한 reponse(응답)을 마치면 바로 연결을 끊는다.
- 자기 할 일이 끝나면 칼퇴

상태정보 유지 안 함

---

- 연결을 끊는 순간 클라이언트 ↔ 서버 통신은 끝나고 상태정보를 유지 하지 않는다.

바로 여기서 쿠키와 세션의 필요성이 생겼다.

- HTTP 프로토콜은 위와 같은 특징으로 모든 요청 간에 의존 관계가 없다. 관련되기 싫어한다.
- 그래서 연결이 끊어지니까 현재 접속한 사용자가 이전에 접속했던 사용자와 같은 사용자인지 아닌지 알 수 있는 방법이 없다.
- 비연결 지향과 상태정보를 유지하지 않음으로서 리소스를 낭비하지 않는 것이 큰 장점이지만

어떤 사이트에 로그인을 한 사용자가 페이지를 요청/연결을 할 때마다 클라이언트는 인증을 해야한다는 단점이 있다.
- 그래서 같은 요청자임을 알기 위해서 상태를 유지해야 할 필요가 있다.

쿠키

---

- 클라이언트 로컬(브라우저)에 저장되는 키, 값이 들어 있는 파일이다. (서버가 넣어줌)
- 이름, 값, 유효시간(서버가 정한 기간에 따라 유효하다!!), 경로 등을 포함하고 있다.
    
    자세한 쿠키의 구성 요소
    
    - 쿠키의 이름(name)
    - 쿠키의 값(value)
    - 쿠키의 만료시간(Expires)
    - 쿠키를 전송할 도메인 이름(Domain)
    - 쿠키를 전송할 경로(Path)
    - 보안 연결 여부(Secure)
    - HttpOnly 여부(HttpOnly)
- 또한 쿠키는 도메인에 따라 제한이 된다고 한다.
    - 유투브 서버에서 준 쿠키는 유투브에만 보내진다.

![https://github.com/WeareSoft/tech-interview/blob/master/contents/images/cookie-process.png?raw=true](https://github.com/WeareSoft/tech-interview/blob/master/contents/images/cookie-process.png?raw=true)

1. 웹브라우저가 서버에 요청
2. 상태를 유지하고 싶은 값을 쿠키(cookie)로 생성
3. 서버가 응답할 때 HTTP 헤더(Set-Cookie)에 쿠키를 포함해서 전송
    
    `Set−Cookie: id=doy`
    
4. 전달받은 쿠키는 웹브라우저에서 관리하고 있다가, 다음 요청 때 쿠키를 HTTP 헤더에 넣어서 전송
    
    `cookie: id=doy`
    
5. 서버에서는 쿠키 정보를 읽어 이전 상태 정보를 확인한 후 응답

- 쿠키 사용 예 (여러가지 정보가 저장가능하다)
    - 아이디, 비밀번호 저장
    - 쇼핑몰 장바구니
    - 웹 사이트의 언어 설정을 바꾸면 서버는 쿠키를 주고 다음 방문 시 이를 기억하고 해당 설정으로 변경

세션

---

- 개념
    - 일정 시간 동안 같은 브라우저로부터 들어오는 요청을 하나의 상태로 보고 그 상태를 유지하는 기술이다.
    - 즉, 웹 브라우저를 통해 서버에 접속한 이후부터 브라우저를 종료할 때까지 유지되는 상태이다.
    - 상태 유지를 하지 않아 인증에 대한 단점을 보완한 부분

어떤 사이트에 들어가면 로그인 유효시간이 있고 연장을 해주어야 로그인이 유지되는데 이 때 세션이 사용되는 것이 아닌가 생각이 들었다.

![https://github.com/WeareSoft/tech-interview/blob/master/contents/images/session-process.png?raw=true](https://github.com/WeareSoft/tech-interview/blob/master/contents/images/session-process.png?raw=true)

세션의 동작 방식을 한번 살펴보자

1. 웹브라우저가 서버에 요청
2. 서버가 해당 웹브라우저(클라이언트)에 유일한 ID(Session ID)를 부여함
3. 서버가 응답할 때 HTTP 헤더(Set-Cookie)에 Session ID를 포함해서 전송쿠키에 Session ID를 JSESSIONID 라는 이름으로 저장
    
    `Set−Cookie: JSESSIONID=xslei13f`
    
4. 웹브라우저는 이후 웹브라우저를 닫기까지 다음 요청 때 부여된 Session ID가 담겨있는 쿠키를 HTTP 헤더에 넣어서 전송
    
    `Cookie: JSESSIONID=xslei13f`
    
5. 서버는 세션 ID를 확인하고, 해당 세션에 관련된 정보를 확인한 후 응답

로그인을 할 때에 로그인 아이디(유저 이름)와 비밀번호를 서버에 보내면 서버는 세션db에서 유저이름을 생성한다.

세션 db(세션)에는 별도의 ID가 있다.

쿠키도 아이디와 비밀번호를 저장한다고 해서 다른 건가 했는데 쿠키가 들고오는 이 아이디와 비밀번호가 동일하다

그래서 같은 웹사이트에서 다른 페이지로 이동(요청)을 하면 쿠키는 요청할 때에 세션ID와 같이 서버에 보내지게 된다! 쿠키는 요청마다 자동으로 보내지기 때문에!! 

서버는 아직까지 쿠키를 가지고 온 요청이 있었고 세션ID를 가지고 있었다는 것만 알고 있다.

가져온 세션ID를 세션db에서 일치하는 것이 있는걸 확인하고서야 서버는 알 수 있다.

이 과정은 한 웹 사이트의 다른 페이지로 계속 이동할 때마다 반복된다. (그래서 세션을 사용하는 부분이 부하가 크다는 의미인 것 같다)

여기서 집고 넘어가야 할 것은 쿠키는 세션ID, 설정 정보 등등 정보를 서버에 전달하기 위한 매개체일 뿐이라는 것!!

상태정보를 유지할 수 있는 것은 세션 덕분이고

이를 가능하게 해주는 것은 상태정보를 계속 주고받아 주는 쿠키 덕분이다.

쿠키와 세션에서 헷갈릴 수 있는 부분이다.

- 쿠키와 세션의 차이점
    - 저장 위치
        - 쿠키 : 클라이언트
        - 세션 : 서버
    - 보안
        - 쿠키 : 클라이언트에 저장되므로 보안에 취약하다.
        - 세션 : 쿠키를 이용해 Session ID만 저장하고 이 값으로 구분해서 서버에서 처리하므로 비교적 보안성이 좋다.
    - 라이프사이클
        - 쿠키 : 만료시간에 따라 브라우저를 종료해도 계속해서 남아 있을 수 있다.
        - 세션 : 만료시간을 정할 수 있지만 브라우저가 종료되면 만료시간에 상관없이 삭제된다.
    - 속도
        - 쿠키 : 클라이언트에 저장되어서 서버에 요청 시 빠르다.
        - 세션 : 실제 저장된 정보가 서버에 있으므로 서버의 처리가 필요해 쿠키보다 느리다.

**추가 공부**

---

토큰에 관해서도 더 정리를 해보아야겠다.

리덕스
