## JVM이란?

**단순하게 말하면, '어떠한 다른 프로그램을 실행시키는 것'이 주 목적이다.
JVM이 가지고 있는 큰 기능으로는 두 가지가 있다.**

1. **자바 프로그램을 어느 기기나 운영체제에서도 실행될 수 있게 하는 기능**
2. **프로그램의 메모리를 관리하며 최적화 해주는 기능**

**즉, 자바 어플리케이션을 클래스 로더로 읽고 자바 API와 함께 실행시키며 JAVA와 OS 사이의 중개자 역할을 하여 OS와 상관없이 재사용을 가능하게 한다.**

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/0e75d411-8e07-468c-aad0-0da98f632537/Untitled.png)

### 먼저 JVM의 메모리 영역을 살펴보자

**-> 총 5가지 영역으로 나눠져 있다. (PC 레지스터/스택/네이티브 메소드 스택/힙/메서드)**

- **PC 레지스터** : 현재 실행되는 명령어의 주소값을 저장하며, 명령어가 바뀌면 업데이트 한다.

- **스택 영역** : 스레드가 메소드를 호출할 때, 해당 메소드의 지역변수/매개변수/메소드정보를 저장한다. 이름 그대로 Stack 자료구조의 형태처럼 LIFO 방식으로 처리한다.

- **네이티브 메소드 스택** : 네이티브 메소드를 실행하기 위한 정보들을 저장한다.
  *-> 네이티브 메소드란 자바로 작성된 코드가 아닌 실행 가능한 기계어로 된 메소드이다.*

- **힙 영역** : 동적인 메모리 크기를 가진 객체들이 저장된다.
  *-> 가비지 컬렉션 기능이 있어서 더 이상 사용되지 않는 객체들을 제거*

- **메소드 영역** : JVM이 시작될 때 생성된다.
  *-> 클래스 파일에 대한 상수, 필드, 메소드 코드, 정적(static) 변수 등을 저장한다. (ps. Java8 부터 Metaspace 영역이라는 이름으로 변경됨)*

### **그렇다면 JVM은 어떻게 메모리 관리를 할까?**

1. **프로그램 실행 시, JVM은 OS로부터 프로그램이 필요한 메모리 공간을 할당받는다.**
   -> JVM이 용도에 따라 여러 영역으로 나눠 메모리를 관리한다. (ex. 힙, 스택)

2. **자바 컴파일러가 소스코드를 읽고, 바이트코드(.class)로 변환한다.**

3. **변환된 .class 파일들을 클래스 로더를 이용해 JVM 메모리 영역으로 로딩한다.**
   -> 클래스 로더를 통해 필요한 클래스를 찾고, 해당 클래스 파일을 읽어 JVM 내부에서 사용할 수 있게 변환하여 메모리에 저장한다.
   -> 클래스 로더는 일반적으로 3가지 계층 구조를 가진다.
   -> 부트스트랩 클래스 로더 : 최상단 클래스 로더, JVM 실행 시 자동 생성, JDK에 포함된 클래스와 런타임 때 필요한 핵심 클래스들을 로딩
   -> 확장 클래스 로더 : 중단 클래스 로더, 말 그대로 범위를 넓혀주는 클래스 로더, JAVA_HOME/jre/lib/ext 폴더와 java.ext.dirs 시스템 변수에 지정된 폴더에서 클래스 파일 로딩
   -> 시스템(or 어플리케이션) 클래스 로더 : 최하단 클래스 로더, 일반적인 어플리케이션에서 사용하는 클래스 로딩, 우리가 직접 만든 클래스들은 이 로더를 통해 로딩

*ps. 어플리케이션에서 전혀 사용되지 않는 클래스여도 해당 바이트코드를 메모리에 올려서 언제든지 사용 가능한 상태로 준비시킴*

4. **로딩된 .class 파일들을 실행 엔진을 통해 해석한다.**

5. **해석된 바이트코드를 메모리 영역에 배치하여 실제 작업을 수행한다.**
   -> JVM은 필요에 따라서 스레드 동기화나 가비지 컬렉션 같은 메모리 관리 작업도 수행

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e66b79a0-13e1-462e-af79-52f090c411ea/Untitled.png)